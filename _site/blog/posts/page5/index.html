<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Blog | Peter Debelak</title>
    <meta name="description" content="Posts about Ruby, Rails, and other technical topics from Peter Debelak">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <style>
      
      *{box-sizing:border-box}*:before,*:after{box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:transparent}body{font-family:Verdana,Geneva,sans-serif;font-size:14px;line-height:1.42857;color:#333;background-color:#fff}img{vertical-align:middle;max-width:100%}html,body{height:100%;margin:0}div.wrapper{min-height:100%;margin-bottom:-39px}.main-header{margin-bottom:10px}@media (min-width: 768px){.main-header{margin-bottom:30px}}.main-header,.main-footer{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px;background-color:#017890}.main-header:before,.main-header:after,.main-footer:before,.main-footer:after{content:" ";display:table}.main-header:after,.main-footer:after{clear:both}.main-footer,.push{width:100%;height:39px}.push{margin-top:30px}.main-header a,.main-footer a,.main-header a:focus,.main-footer a:focus{text-decoration:none;color:#fff}main{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}main:before,main:after{content:" ";display:table}main:after{clear:both}@media (min-width: 768px){main{width:750px}}@media (min-width: 992px){main{width:970px}}@media (min-width: 1200px){main{width:1170px}}.main-nav{margin-bottom:20px;padding-right:15px;padding-left:15px;padding-right:15px;padding-left:15px}.main-nav ul{padding:0;list-style:none;margin:0}.main-nav ul li a{color:#017890;padding:10px 15px;border-radius:4px;display:block;text-decoration:none}.main-nav ul li a:hover,.main-nav ul li a:focus{text-decoration:none;background-color:#eee}.main-nav ul li.active a,.main-nav ul li.active a:hover,.main-nav ul li.active a:focus{color:#fff;background-color:#017890}@media (min-width: 768px){.main-nav{float:left;width:34%}}@media (min-width: 992px){.main-nav{float:left;width:25%}}@media (min-width: 768px){.main-nav{float:right}}@media (max-width: 767px){.main-nav ul>li>a{padding:5px 10px}}.main-content{padding-right:15px;padding-left:15px;padding-right:15px;padding-left:15px}@media (min-width: 768px){.main-content{float:left;width:66%}}@media (min-width: 992px){.main-content{float:left;width:75%}}.content-wrap{margin-left:-15px;margin-right:-15px}.content-wrap:before,.content-wrap:after{content:" ";display:table}.content-wrap:after{clear:both}.lead{margin:0 0 10px;font-size:16px;margin-bottom:20px;font-weight:300;line-height:1.4}@media (min-width: 768px){.lead{font-size:21px}}h1,.h1{font-size:36px}h2,.h2{font-size:30px}h3,.h3{font-size:24px}h4,.h4{font-size:18px}h5,.h5{font-size:14px}h6,.h6{font-size:12px}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{font-family:inherit;font-weight:500;line-height:1.1;color:inherit;margin-top:20px;margin-bottom:10px}h1 small,h1 .small,h2 small,h2 .small,h3 small,h3 .small,h4 small,h4 .small,h5 small,h5 .small,h6 small,h6 .small,.h1 small,.h1 .small,.h2 small,.h2 .small,.h3 small,.h3 .small,.h4 small,.h4 .small,.h5 small,.h5 .small,.h6 small,.h6 .small{font-weight:normal;line-height:1;color:#777;font-size:65%}p{margin:0 0 10px}

    </style>
    <script>
      if (document.location.hostname.match('peterdebelak.com')) {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-64190606-1', 'auto');
        ga('send', 'pageview');
      }
    </script>
  </head>
  <body >
    <div class="wrapper">
      <header class="main-header">
        <h1><a id="home" href="/">Peter Debelak</a></h1>
      </header>

      <main>
        <div class="content-wrap">
  <nav class="main-nav" role="navigation">
    <ul>
      <li class=""><a id="about" href="/about/">About</a></li>
      <li class=""><a id="resume" href="/resume/">Resume</a></li>
      <li class="active"><a id="blog" href="/blog/posts">Blog</a></li>
      <li><a id="github" href="https://github.com/pdebelak">Peter on Github</a></li>
    </ul>
  </nav>

  <section class="main-content">
    
  <article class="post">
    <header>
      <h1 class="blog-index">Recursion Basics - Adding Numbers in an Array with Javascript<br><small><a href="/blog/posts/recursion-basics-adding-numbers-in-an-array-with-javascript/#disqus_thread">comments</a></small></h1>
      <p class="date-line">Last updated 31 October 2014</p>
    </header>
    <p>Recursion can be confusing, especially for people new to programming. I thought I'd post a very simple example here to help beginners.</p>

<p class="lead">The problem</p>
<p>Let's say you want to add all the numbers in an array without using a loop. (Why can't you use a loop? Because.) If you knew beforehand the number of items in the array you could write:</p>
<pre>
function addArray(arrayOfNums) {
    return arrayOfNums[0] + arrayOfNums[1];
}
</pre>
<p>That would work great for arrays with only 2 numbers. You could write out as many <code>arrayOfNums[x] +</code> as you wanted, but what if you needed to add an array with hundreds of numbers? Enter recursion. Try this:</p>
<pre>
function addArray(arrayOfNums) {
    return arrayOfNums.shift() + addArray(arrayOfNums);
}
</pre>
<p>What is happening there? <code>arrayOfNums.shift()</code> removes the first item in an array and returns that item, so you are basically asking your code to add the first number in the array to the sum (using the <code>addArray</code> function) of the remaining items in the array. The function keeps calling itself using progressively smaller arrays until it has added all the numbers together. That is the magic of recursion.</p>
<p>So we're all set? Unfortunately, no. Give it a try and you'll get an infinite loop! You need to set a condition upon which the recursion will end and the function will exit.</p>
<p>In this case, it makes sense to just return <code>0</code> if the array is empty because the sum of an empty array should be 0.</p>
<pre>
function addArray(arrayOfNums) {
    if (arrayOfNums.length === 0) { return 0; }
    return arrayOfNums.shift() + addArray(arrayOfNums);
}
</pre>
<p>Now if you run this code you will get the expected results! I hope this can help a beginner get the hang of recursion.</p>

    <hr>
  </article>

  <article class="post">
    <header>
      <h1 class="blog-index">Complex ActiveRecord Queries with Includes<br><small><a href="/blog/posts/complex-activerecord-queries-with-includes/#disqus_thread">comments</a></small></h1>
      <p class="date-line">Last updated 18 October 2014</p>
    </header>
    <p>ActiveRecord's way of separating Ruby developers from writing SQL is fantastic, but sometimes its behavior can be a little surprising. I ran into some ActiveRecord-related trouble recently and wanted to share the solution.</p>

<p class="lead">The situation</p>
<p>I had a model, let's call it <code>DateRange</code> that represents a range of dates (amazing, right?). Each date range could have many <code>TakenDate</code>s representing a range of dates that fall within its parent date range and are no longer available.</p>
<p class="lead">The problem</p>
<p>Let's say I'm trying to find out if a given range of dates is not taken within an existing <code>DateRange</code>. That means that it falls within a given range and has not been taken by a <code>TakenDate</code>. So I want to do a query that returns all <code>DateRange</code>s and associated <code>TakenDate</code>s if they exist. Great! ActiveRecord has an <code>includes</code> method just for this. So I wrote a query like so:</p>
<pre>
DateRange.includes(:taken_dates)
  .where('date_ranges.start_date &gt;= ? AND date_ranges.end_date &lt;= ?', 
          some_date, some_other_date)
  .where.not('(taken_dates.start_date &gt;= :start_date AND taken_dates.start_date &lt;= :end_date) OR (taken_date.end_date &gt;= :start_date AND taken_date.end_date &lt;= :end_date)', 
          start_date: some_date, end_date: some_other_date)
</pre>
<p>I know that is bewildering, but given two dates, it tries to find a <code>DateRange</code> that it falls within that doesn't have a conflicting <code>TakenDate</code>. It doesn't work, however. Why? Because it never returns any <code>DateRange</code> without any <code>TakenDate</code>s. I was surprised about that, because I assumed the <code>where.not</code> call would happily return any <code>DateRange</code>s without <code>TakenDate</code>s.</p>
<p>For a while I was stymied at how I could do this with a single query. It would be possible to do two different queries and combine them, but that would be slower and would not leave me with an ActiveRecord collection.</p>
<p class="lead">The solution</p>
<pre>
DateRange.includes(:taken_dates)
  .where('date_ranges.start_date &gt;= ? AND date_ranges.end_date &lt;= ?', 
          some_date, some_other_date)
  .where('taken_dates.id IS NULL OR NOT (taken_dates.start_date &gt;= :start_date AND taken_dates.start_date &lt;= :end_date) OR (taken_date.end_date &gt;= :start_date AND taken_date.end_date &lt;= :end_date)', 
          start_date: some_date, end_date: some_other_date)
</pre>
<p>That is one ugly query, but the key is specifying <code>taken_date.is IS NULL OR</code> some condition. This returns everything without an association while still allowing you to do a query based on the association if it exists!</p>
<p>I don't doubt that there is a better way to tackle this problem (feel free to let me know in the comments!), but I think it is good to know some tricks for those corner cases where ActiveRecord doesn't make your life easy.</p>

    <hr>
  </article>

  <article class="post">
    <header>
      <h1 class="blog-index">Routing with Rails and Angular<br><small><a href="/blog/posts/routing-with-rails-and-angular/#disqus_thread">comments</a></small></h1>
      <p class="date-line">Last updated 11 October 2014</p>
    </header>
    <p>There are a lot of great blog posts about setting up an app with <a href="http://rubyonrails.org/">Rails</a> as the back-end and <a href="https://angularjs.org/">AngularJS</a> as the front-end. You can find some <a href="http://www.intridea.com/blog/2014/9/25/how-to-set-up-angular-with-rails">here</a>, <a href="http://angular-rails.com/bootstrap.html">here</a>, or <a href="https://www.honeybadger.io/blog/2013/12/11/beginners-guide-to-angular-js-rails">here</a>. When it comes to routing, though, the best approach is unclear.

<p>If you are using <a href="https://docs.angularjs.org/api/ngRoute">ngRoute</a> (and you really should be to allow deep linking on your Angular app) your server should be able to handle requests like <code>/blog/posts/1</code> and show the appropriate blog post. You can easily do this by just routing all requests to your main index page and let Angular handle the routing. But what urls should Angular use to fetch the post from the server? You could namespace all of the server responses like <code>/api/blog/posts/1</code> but that doesn't really make sense. What you really want is to respond to <code>.html</code> requests by displaying the single-page Angular html and to respond to <code>.json</code> requests with the appropriate resource as json.
<p class="lead">Rails makes this easy!</p>
<p>As anyone who has generated scaffolding with Rails know, it is easy to craft a different response whether it is <code>.html</code> or <code>.json</code>. Your controllers frequently look like:
<pre>
def show
  @post = Post.find(params[:id])
  respond_to do |format|
    format.html # render the html view
    format.json # render the json view
  end
end
</pre>
<p>So, if I have my home page at <code>static_pages#home</code> I might write:</p>
<pre>
respond_to do |format|
  format.html { render 'static_pages/home' }
  format.json # rendering the show.json.erb file
end
</pre>
<p>Now you don't have to try to redirect all requests in your <code>config/routes</code> file or do anything crazy to properly respond to deep links.</p>
<p>This works fine, but I don't usually feel it necessary to create the <code>.json.erb</code> file for simple models and it also gets quite repetitive to have the same <code>respond_to</code> block in every controller action that takes a get request. Instead, I find that declaring a custom method in your <code>ApplicationController</code> that handles it for you:</p>
<pre>
def ng_respond(response_for_json)
  respond_to do |format|
    format.html { render 'static_pages/home' }
    format.json { render json: response_for_json.to_json }
  end
end
</pre>
<p>That way you can create controller actions like this:</p>
<pre>
def show
  @post = Post.find(params[:id])
  ng_respond(@post)
end
</pre>
<p>I hope this helps you with routing in your Rails/Angular apps. Leave any tips you might have in the comments.
</p></p></p></p>

    <hr>
  </article>

<nav>
  <ul class="pager">
    
      <li class="previous">
        <a id="previous" href="/blog/posts/page4/">&larr; Newer posts</a>
      </li>
    
    
  </ul>
</nav>

  </section>
</div>

      </main>
      <div class="push"></div>
    </div>
    <footer class="main-footer">
      <span class="pull-left">Press <code>?</code> for help</span>
      <p class="mail-link">
        <a href="mailto:pdebelak@gmail.com">Contact Peter</a>
      </p>
    </footer>
    <link rel="stylesheet" href="/css/main.css">
    <script src="/js/shortcuts.min.js"></script>
    <script type="text/javascript">
      var disqus_shortname = 'peterdebelak';
      (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script>
  </body>
</html>
